<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="assets/js/marked.min.js"></script>
  
  <!-- Open Graph / Facebook -->
<meta property="og:type" content="website" />
<meta property="og:url" content="https://ouistitis.online/" />
<meta property="og:title" content="Ouistitis" />
<meta property="og:description" content="Ouistitis acc√©l√®re la croissance de votre communaut√© gr√¢ce √† ses diff√©rentes fonctionnalit√©s comme l'int√©gration de l'IA, la gestion des anniversaires, l'accueil des nouveaux membres, le syst√®me de niveaux, et plus encore !" />
<meta property="og:image" content="https://ouistitis.online/Illustration.svg" />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:url" content="https://ouistitis.online/" />
<meta property="twitter:title" content="Ouistitis" />
<meta property="twitter:description" content="Ouistitis acc√©l√®re la croissance de votre communaut√© gr√¢ce √† ses diff√©rentes fonctionnalit√©s comme l'int√©gration de l'IA, la gestion des anniversaires, l'accueil des nouveaux membres, le syst√®me de niveaux, et plus encore !" />
<meta property="twitter:image" content="https://ouistitis.online/Illustration.svg" />
  
  <!-- 
    - primary meta tags
  -->
  
  <title>Ouistitis - Tableau de bord</title>
  <meta name="title" content="Ouistitis ‚Äî Bot Discord Multifonctions">
  <meta name="description" content="Ouistitis acc√©l√®re la croissance de votre communaut√© gr√¢ce √† ses diff√©rentes fonctionnalit√©s comme l'int√©gration de l'IA, la gestion des anniversaires, l'accueil des nouveaux membres, le syst√®me de niveaux, et plus encore !">

  <!-- 
    - favicon
  -->
  <link rel="icon" href="favicon.ico">


  <!-- 
    - custom css link
  -->
  <link rel="stylesheet" href="assets/css/dashboard.css">

  <!-- 
    - google font link
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap"
    rel="stylesheet">
	
<!-- PRELOADER -->

<div id="preloader">
	<div class="spinner">
		<div class="double-bounce1"></div>
		<div class="double-bounce2"></div>
	</div>
</div>
 
<script>
    var loader = document.getElementById("preloader");
    var minDisplayTime = 1000;
    var startTime = Date.now();

    document.body.style.overflow = 'hidden';

    window.addEventListener("load", function () {
        var elapsedTime = Date.now() - startTime;
        var remainingTime = minDisplayTime - elapsedTime;

        if (remainingTime > 0) {
            setTimeout(function() {
                loader.style.display = "none";
                document.body.style.overflow = '';
            }, remainingTime);
        } else {
            loader.style.display = "none";
            document.body.style.overflow = '';
        }
    });
</script>
	
  <!-- 
    - header
  -->

<body>
  <header class="header" data-header>
    <div class="container">

    <a href="./" class="logo">
      <img src="Ouistitis.png" width="50" height="50" alt="Logo">
      <h1 class="logo-text" style="color:#FFFFFF;"><b>OUISTITIS</b></h1>
    </a>

      <nav class="navbar" data-navbar>

        <div class="navbar-top">
		

          <a href="#" class="logo"><h1><b>Ouistitis</b></h1>
        
          </a>

          <button class="nav-close-btn" aria-label="close menu" data-nav-toggler-dash>
            <ion-icon name="close-outline" aria-hidden="true"></ion-icon>
          </button>

        </div>

        <ul class="navbar-list">

          <li>
            <a href="./" class="navbar-link">Accueil</a>
          </li>

          <li>
            <a href="./login" class="navbar-link">Dashboard</a>
          </li>
		  
        </ul>

      </nav>

      <div class="btn-group">
	  
      <!-- Menu pour les utilisateurs non connect√©s -->
      <div class="nav-container" id="navContainerNotLoggedIn">
        <button class="nav-open-btn" aria-label="open menu" data-nav-toggler-dash>
		  <i class="user circle icon"></i>
		  	<i class="chevron down icon"></i>
        </button>
        <ul class="dropdown-menu hidden" id="dropdownMenuDash">
          <div class="logo-dropdown">
            <a href="./login" class="btn btn-primary-blue" onclick="redirectToLogin()">Connexion</a>
          </div>
          <li><h3 class="btn-link-title">NAVIGATION</h3></li>
          <li><a href="./" class="btn-link-desc">Accueil</a></li>
		  <li><a href="./commands" class="btn-link-desc">Commandes</a></li>
          <li><a href="./dashboard" class="btn-link-desc">Tableau de bord</a></li>
		  
        </ul>
      </div>

      <!-- Menu pour les utilisateurs connect√©s -->
      <div class="nav-container" id="navContainerLoggedIn">
        <button class="nav-open-btn" aria-label="open menu" data-nav-toggler-logged>
          <img id="serverIcon" class="serverIcon hidden" alt="." width="50" height="50">
		  	<i class="chevron down icon"></i>
        </button>
        <ul class="dropdown-menu hidden" id="dropdownMenuLogged">
            <li><h3 class="btn-link-server server-name"></h3></li>
			<div class="logo-dropdown">

            <button id="logoutBtn" class="btn btn-primary-blue">D√©connexion</button>
          </div>
          <li><h3 class="btn-link-title">NAVIGATION</h3></li>
          <li><a href="./" class="btn-link-desc">Accueil</a></li>
		  <li><a href="./commands" class="btn-link-desc">Commandes</a></li>
          <li><a href="./dashboard" class="btn-link-desc">Tableau de bord</a></li>
		  
          <li><h3 class="btn-link-title">TABLEAU DE BORD</h3></li>
          <li><a href="./features" class="btn-link-desc">Fonctionnalit√©s</a></li>
          <li><a href="./levels" class="btn-link-desc">Niveaux</a></li>
          <li><a href="./welcome" class="btn-link-desc">Bienvenue</a></li>
          <li><a href="./birthdays" class="btn-link-desc">Anniversaires</a></li>
        </ul>
      </div>

      <div class="overlay" data-overlay data-nav-toggler-dash></div>

      </div>

    </div>
  </header>
  
		<script>
			function openInNewWindow(event) {
			event.preventDefault();
			window.open('https://discord.com/oauth2/authorize?client_id=1240398531257176144&permissions=8&integration_type=0&scope=bot+applications.commands', '_blank', 'width=500,height=800');
			}
		</script>
  
    <style>
	
    .section-content {
      margin-bottom: 14px;
	  margin-top: 24px;
      padding: 20px;
      background: #191a20;
      border-left: 3px solid #8891f2;
      border-radius: 5px;
      transition: all 0.3s ease;
	  text-align: justify;
	  line-height: 2.2;
    }
	
	code {
      background-color: #3c4270;
	  border-radius: 4px;
	  padding: 2px 4px;
	  font-family: Poppins;
	  font-size: 0.9em;
	  font-weight: 450;
	  transition: all 0.3s ease;
   	  color: #FFFFFF;
	  white-space: nowrap;
	}

	code:hover {
	  background-color: #5865f2;
	}
	
	.nav-container {
	  position: relative;
	  display: inline-block;
	}

	.dropdown-menu {
	  display: none;
	  position: absolute;
	  top: 65px;
	  right: 0;
	  transform: translateX(-50%);
	  background-color: #191a20;
	  z-index: 1000;
	  list-style: none;
	  padding: 5px;
	  margin: 0;
	  width: 220px;
	  border-radius: 20px;
	  filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.4));
	  opacity: 0;
	  transform: translateY(-10px);
	  transition: opacity 0.15s cubic-bezier(.4, 0, .2, 1), transform 0.15s cubic-bezier(.4, 0, .2, 1);
	}
	
	#logoutBtn {
	  display: block;
	  margin-left: 10px;
	  margin-right: 10px;
	  margin-bottom: 10px;
	  transition: 0.3s;
    }

	.dropdown-menu a {
	  display: block;
	  margin: 10px;
	  transition: 0.3s;
    }

	.dropdown-menu a:hover {

	}

	.dropdown-menu.show {
	  display: block;
	  opacity: 1;
	  transform: translateY(0);
	}

	.dropdown-menu.hide {
	  opacity: 0;
	  transform: translateY(-10px);
	}
	
  </style>
  
      <!-- 
        - #INSTRUCTION
      -->

      <section class="section-instruction" aria-label="instruction">
        <div class="container" id="feature">
		  
          <h2 class="h1 section-title text-center">Bienvenue</h2>

          <p class="section-text text-center">
		Configure l'attribution des r√¥les, personnalise et d√©fini quel salon o√π envoyer le message de bienvenue.
          </p>
		  
		  <br>
		  <br>
		  
		<h2 class="h2 section-title text-center">
			<button id="backBtn" class="btn btn-primary-header">Retour</button>
		</h2>

		<h2 class="h3 section-title text-center">
			<div class="save-message" id="status" style="color: #ccc"></div>
		</h2>

  <style>
    .highlight {
	font-weight: 600;
      color: #ffffff;
	  margin-right: 20px;
    }
	.section-text li {
	  margin-top: 10px;
      display: flex;
      align-items: center;
      color: #bfbfc4;
    }
	.form-item {
      margin-bottom: 30px;
    }
	.slider {
	margin-top: 15px;
	}
  </style>

    <div class="welcome-config">
        <div class="welcome-message">
			<h2>Personnalisation</h2>
                <div class="instructions section-text">
                    <p>Utilise les codes suivants pour embellir ton message.</p>
					<br>
					<ul>
                        <li><span class="highlight"><code>{username}</code> </span> Nom de l'utilisateur</li>
                        <li><span class="highlight"><code><@{userid}></code> </span> Mentionner l'utilisateur</li>
                        <li><span class="highlight"><code>{servername}</code> </span> Nom du serveur</li>
                    </ul>
					<br>
                </div>
                <div class="form-group">
                    <div class="form-item">
                        <h3>Titre</h3>
                        <textarea type="text-welcome-title" id="welcomeTitle" placeholder="{username} vient juste d\'arriver !" class="form-input" maxlength="256"></textarea>
                    </div>
                    <div class="form-item">
                        <h3>Description</h3>
                        <textarea type="text-welcome-desc" id="welcomeDescription" placeholder="Bienvenue <@{userid}> dans le serveur **{servername}**, on esp√®re que tu passeras un bon moment ici ! üôà" class="form-input" maxlength="2048"></textarea>
                    </div>
                    <div class="form-item">
                        <h3>Couleur</h3>
                        <input type="text" id="welcomeColor" placeholder="A0A7F2" class="form-input text-welcome-color" maxlength="6" pattern="^[0-9A-Fa-f]{6}$">
                    </div>
                    <div class="form-item">
                        <h3>Photo de profil</h3>
                        <input type="checkbox" id="displayAvatar" class="slider-checkbox">
                        <label for="displayAvatar" class="slider-label">
                        <span class="slider"></span>
                        </label>
                    </div>
					<br>
                <button id="saveWelcomeSettingsBtn" class="btn btn-primary-blue">Enregistrer</button>
            </div>
        </div>
    </div>
	
	
    
	<div class="welcome-message">
		<h2>Aper√ßu</h2>
			<p class="section-text">Utilise le mode paysage sur mobile pour un aper√ßu fid√®le.</p>
			<br>
	<div class="welcome-config-mid">
        <div class="welcome-embed">
		    <div id="welcomePreview" class="embedPreview">
				<div class="embed-preview-content">
					<h3 class="embed-preview-title"></h3>
					<div class="embed-preview-description"></div>
				</div>
					<div class="embed-preview-avatar" style="display: none;">
					<img src="User.png" alt="Avatar" id="previewAvatar" width="100" height="100">
				</div>
			</div>
		</div>
	</div>
</div>

    <div class="welcome-selector">
        <h2>D√©finir le salon d'accueil</h2>
			<div class="welcome-chanel">
				<p id="currentChannel"><strong>Salon actuel</strong><span id="currentChannelName">Non d√©fini</span></p>
				<button id="deleteChannelBtn" class="btn btn-remove">√ó</button>
		    </div>
				<div class="form-group">
					<select id="channelSelect">
					<!-- Options ajout√©es dynamiquement -->
					</select>
				<button id="saveChannelBtn" class="btn btn-primary-blue">D√©finir</button>
            </div>
		</div>

	    <div class="welcome-selector">
		  <h2>Attribution</h2>
			<div class="level-selector">
				<select id="roleSelect">
				<!-- Options ajout√©es dynamiquement -->
				</select>
            <button id="saveRoleBtn" class="btn btn-primary-blue">Ajouter</button>
        </div>
	</div>

    <div id="roleList">
    </div>
	
        <div class="btn-group3"></div>
      </div>
    </div>
  </section>

  <script>
    let abortController;
    let allRoles = [];
    let allChannels = [];
	
	function displayServerName() {
      const serverName = localStorage.getItem('serverName');
      const serverNameElements = document.querySelectorAll('.server-name');

      serverNameElements.forEach(element => {
        if (serverName) {
          element.textContent = serverName;
        } else {
          element.textContent = 'Aucun serveur connect√©.';
        }
      });
    }

    document.addEventListener('DOMContentLoaded', displayServerName);

    async function loadWelcomeConfig() {
      abortController = new AbortController();
      const signal = abortController.signal;
      const token = localStorage.getItem('serverToken');
      const isAuthenticated = localStorage.getItem('isAuthenticated');

      console.log('R√©cup√©ration du token:', token);
      console.log('isAuthenticated:', isAuthenticated);

      if (!token || isAuthenticated !== 'true') {
        window.location.href = './login';
        return;
      }

      try {
        const response = await fetch('https://api.ouistitis.online/verifyToken', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token }),
          signal
        });

        if (response.ok) {
          const result = await response.json();
          console.log('Token v√©rifi√©, r√©sultat:', result);
          if (result.valid) {
            const serverIcon = document.getElementById('serverIcon');
            serverIcon.src = result.serverIcon;
            allChannels = await loadChannels(token);
            allRoles = await loadRoles(token);
            await loadCurrentWelcomeSettings(token);
          } else {
            localStorage.removeItem('serverToken');
            localStorage.removeItem('isAuthenticated');
            window.location.href = './login';
          }
        } else {
          const text = await response.text();
          console.error('Erreur de serveur:', text);
          document.getElementById('status').textContent = 'Erreur avec le serveur';
        }
      } catch (error) {
        if (error.name !== 'AbortError') {
          document.getElementById('status').textContent = 'Erreur lors de la v√©rification du token';
        }
      }
    }

    async function loadChannels(token) {
      try {
        const response = await fetch('https://api.ouistitis.online/getTextChannels', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token })
        });

        if (response.ok) {
          const channels = await response.json();
          console.log('Salons r√©cup√©r√©s:', channels);
          displayChannelOptions(channels);
          return channels;
        } else {
          const text = await response.text();
          console.error('Erreur lors de la r√©cup√©ration des salons (response.ok=false):', text);
          document.getElementById('status').textContent = 'Erreur lors de la r√©cup√©ration des salons';
          return [];
        }
      } catch (error) {
        console.error('Erreur lors de la r√©cup√©ration des salons (catch):', error);
        document.getElementById('status').textContent =
          'Erreur lors de la r√©cup√©ration des salons';
        return [];
      }
    }

    async function loadRoles(token) {
      try {
        const response = await fetch('https://api.ouistitis.online/getRoles', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token })
        });

        if (response.ok) {
          const roles = await response.json();
          console.log('R√¥les r√©cup√©r√©s:', roles);
          displayRoleOptions(roles.filter(role => role.exists));
          return roles;
        } else {
          const text = await response.text();
          console.error('Erreur lors de la r√©cup√©ration des r√¥les (response.ok=false):', text);
          document.getElementById('status').textContent = 'Erreur lors de la r√©cup√©ration des r√¥les';
          return [];
        }
      } catch (error) {
        console.error('Erreur lors de la r√©cup√©ration des r√¥les (catch):', error);
        document.getElementById('status').textContent =
          'Erreur lors de la r√©cup√©ration des r√¥les';
        return [];
      }
    }

    async function loadCurrentWelcomeSettings(token) {
      try {
        const response = await fetch('https://api.ouistitis.online/getWelcomeSettings', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token })
        });

        if (response.ok) {
          const settings = await response.json();
          console.log('Param√®tres de bienvenue r√©cup√©r√©s:', settings);
          displayCurrentWelcomeSettings(settings);
        } else {
          const text = await response.text();
          console.error('Erreur lors de la r√©cup√©ration des param√®tres (response.ok=false):', text);
          document.getElementById('status').textContent = 'Erreur lors de la r√©cup√©ration des param√®tres';
        }
      } catch (error) {
        console.error('Erreur lors de la r√©cup√©ration des param√®tres (catch):', error);
        document.getElementById('status').textContent =
          'Erreur lors de la r√©cup√©ration des param√®tres';
      }
    }

	function displayChannelOptions(channels) {
	  const channelSelect = document.getElementById('channelSelect');
		channelSelect.innerHTML = '';

	  channels.forEach(channel => {
		const option = document.createElement('option');
		option.value = channel.id;
		option.textContent = `# ${channel.name}`;
		option.classList.add('channel-option');
		channelSelect.appendChild(option);
		});
	}

    function displayRoleOptions(roles) {
      const roleSelect = document.getElementById('roleSelect');
      roleSelect.innerHTML = '';

      roles.forEach(role => {
        const option = document.createElement('option');
        option.value = role.id;
        option.textContent = role.name;
        roleSelect.appendChild(option);
      });
    }

    function displayCurrentWelcomeSettings(settings) {
        const currentChannelSpan = document.getElementById('currentChannelName');
        const roleList = document.getElementById('roleList');
        roleList.innerHTML = '';

        if (settings.channel) {
            const currentChannel = allChannels.find(channel => channel.id === settings.channel);
            currentChannelSpan.textContent = currentChannel ? `# ${currentChannel.name}` : 'Salon supprim√©';
        } else {
            currentChannelSpan.textContent = 'Non d√©fini';
        }

        if (settings.roles) {
            const rolesList = document.createElement('ul');
            rolesList.classList.add('role-list');

            settings.roles.forEach(roleId => {
                const currentRole = allRoles.find(role => role.id === roleId);
                if (currentRole) {
                    const li = document.createElement('li');
                    li.classList.add('role-item-welcome');
                    li.textContent = currentRole.name;
                    const button = document.createElement('button');
                    button.textContent = '√ó';
                    button.classList.add('welcome-btn-remove');
                    button.addEventListener('click', () => deleteWelcomeRole(roleId));
                    li.appendChild(button);
                    rolesList.appendChild(li);
                }
            });

            roleList.innerHTML = '';
            roleList.appendChild(rolesList);
        }

        document.getElementById('welcomeColor').value = settings.welcomeMessage?.color || 'e6e1b0';
        document.getElementById('welcomeTitle').value = settings.welcomeMessage?.title || '**{username} vient juste d\'arriver !**';
        document.getElementById('welcomeDescription').value = settings.welcomeMessage?.description || 'Bienvenue <@{userid}> dans le serveur **{servername}**, on esp√®re que tu passeras un bon moment ici ! üçå';
        document.getElementById('displayAvatar').checked = settings.welcomeMessage?.displayAvatar !== undefined ? settings.welcomeMessage.displayAvatar : true;
        updateWelcomePreview();
    }

    async function saveWelcomeChannel() {
      const token = localStorage.getItem('serverToken');
      const channelSelect = document.getElementById('channelSelect');
      const channel = channelSelect.value;

      console.log('Enregistrement du salon de bienvenue:', { channel });

      try {
        const response = await fetch('https://api.ouistitis.online/setWelcomeChannel', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token, channel })
        });

        if (response.ok) {
          await loadCurrentWelcomeSettings(token);
        } else {
          const text = await response.text();
          console.error('Erreur lors de l\'enregistrement du salon (response.ok=false):', text);
          document.getElementById('status').textContent = 'Erreur lors de l\'enregistrement du salon';
        }
      } catch (error) {
        console.error('Erreur lors de l\'enregistrement du salon (catch):', error);
        document.getElementById('status').textContent =
          'Erreur lors de l\'enregistrement du salon';
      }
    }

    async function deleteWelcomeChannel() {
      const token = localStorage.getItem('serverToken');

      console.log('Suppression du salon de bienvenue');

      try {
        const response = await fetch('https://api.ouistitis.online/deleteWelcomeChannel', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token })
        });

        if (response.ok) {
          await loadCurrentWelcomeSettings(token);
        } else {
          const text = await response.text();
          console.error('Erreur lors de la suppression du salon (response.ok=false):', text);
          document.getElementById('status').textContent = 'Erreur lors de la suppression du salon';
        }
      } catch (error) {
        console.error('Erreur lors de la suppression du salon (catch):', error);
        document.getElementById('status').textContent =
          'Erreur lors de la suppression du salon';
      }
    }

    async function saveWelcomeRole() {
      const token = localStorage.getItem('serverToken');
      const roleSelect = document.getElementById('roleSelect');
      const role = roleSelect.value;

      console.log('Ajout du r√¥le de bienvenue:', { role });

      try {
        const response = await fetch('https://api.ouistitis.online/setWelcomeRole', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token, role })
        });

        if (response.ok) {
          await loadCurrentWelcomeSettings(token);
        } else {
          const text = await response.text();
          console.error('Erreur lors de l\'ajout du r√¥le (response.ok=false):', text);
          document.getElementById('status').textContent = 'Erreur lors de l\'ajout du r√¥le';
        }
      } catch (error) {
        console.error('Erreur lors de l\'ajout du r√¥le (catch):', error);
        document.getElementById('status').textContent =
          'Erreur lors de l\'ajout du r√¥le';
      }
    }

    async function deleteWelcomeRole(roleId) {
        const token = localStorage.getItem('serverToken');

        console.log('Suppression du r√¥le de bienvenue:', { roleId });

        try {
            const response = await fetch('https://api.ouistitis.online/deleteWelcomeRole', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ token, roleId })
            });

            if (response.ok) {
                await loadCurrentWelcomeSettings(token);
            } else {
                const text = await response.text();
                console.error('Erreur lors de la suppression du r√¥le (response.ok=false):', text);
                document.getElementById('status').textContent = 'Erreur lors de la suppression du r√¥le';
            }
        } catch (error) {
            console.error('Erreur lors de la suppression du r√¥le (catch):', error);
            document.getElementById('status').textContent = 'Erreur lors de la suppression du r√¥le';
        }
    }
	
function updateWelcomePreview() {
    const welcomeColor = document.getElementById('welcomeColor').value;
    let welcomeTitle = document.getElementById('welcomeTitle').value;
    let welcomeDescription = document.getElementById('welcomeDescription').value;
    const displayAvatar = document.getElementById('displayAvatar').checked;

    const usernamePlaceholder = '{username}';
    const useridPlaceholder = '{userid}';
    const mentionPlaceholder = '<code>@Ouistitis</code>';
    const servernamePlaceholder = '{servername}';
    
    const sampleUsername = 'Ouistitis';
    const sampleUserId = '1240398531257176144';
    const sampleServername = 'Donkey Kong';
    
    welcomeTitle = welcomeTitle.replace(`<@${useridPlaceholder}>`, mentionPlaceholder)
                               .replace(useridPlaceholder, sampleUserId)
                               .replace(usernamePlaceholder, sampleUsername)
                               .replace(servernamePlaceholder, sampleServername);
    welcomeDescription = welcomeDescription.replace(`<@${useridPlaceholder}>`, mentionPlaceholder)
                                           .replace(useridPlaceholder, sampleUserId)
                                           .replace(usernamePlaceholder, sampleUsername)
                                           .replace(servernamePlaceholder, sampleServername);
    
    const previewElement = document.querySelector('.welcome-embed');
    previewElement.style.borderLeftColor = `#${welcomeColor}`;
    document.querySelector('.embed-preview-title').innerHTML = marked.parse(welcomeTitle);
    document.querySelector('.embed-preview-description').innerHTML = marked.parse(welcomeDescription);

    const avatarElement = document.querySelector('.embed-preview-avatar');
    if (displayAvatar) {
        avatarElement.style.display = 'flex';
        document.getElementById('previewAvatar').src = 'User.png';
    } else {
        avatarElement.style.display = 'none';
    }
}

document.querySelectorAll('#welcomeTitle, #welcomeDescription, #welcomeColor, #displayAvatar').forEach(element => {
    element.addEventListener('input', updateWelcomePreview);
});

    async function updateWelcomeSettings() {
        const token = localStorage.getItem('serverToken');
        const welcomeColor = document.getElementById('welcomeColor').value;
        const welcomeTitle = document.getElementById('welcomeTitle').value;
        const welcomeDescription = document.getElementById('welcomeDescription').value;
        const displayAvatar = document.getElementById('displayAvatar').checked;

        try {
            const response = await fetch('https://api.ouistitis.online/updateWelcomeSettings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    token,
                    welcomeMessage: {
                        color: welcomeColor,
                        title: welcomeTitle,
                        description: welcomeDescription,
                        displayAvatar
                    }
                })
            });

            if (response.ok) {
                alert('Param√®tres de bienvenue mis √† jour avec succ√®s');
            } else {
                const text = await response.text();
                console.error('Erreur lors de la mise √† jour des param√®tres (response.ok=false):', text);
                document.getElementById('status').textContent = 'Erreur lors de la mise √† jour des param√®tres';
            }
        } catch (error) {
            console.error('Erreur lors de la mise √† jour des param√®tres (catch):', error);
            document.getElementById('status').textContent = 'Erreur lors de la mise √† jour des param√®tres';
        }
    }

    document.getElementById('saveChannelBtn').addEventListener('click', saveWelcomeChannel);
    document.getElementById('deleteChannelBtn').addEventListener('click', deleteWelcomeChannel);
    document.getElementById('saveRoleBtn').addEventListener('click', saveWelcomeRole);
	
	
document.getElementById('saveWelcomeSettingsBtn').addEventListener('click', async () => {
  const token = localStorage.getItem('serverToken');
  const welcomeColor = document.getElementById('welcomeColor').value.trim();
  const welcomeTitle = document.getElementById('welcomeTitle').value;
  const welcomeDescription = document.getElementById('welcomeDescription').value;
  const displayAvatar = document.getElementById('displayAvatar').checked;

  const status = document.getElementById('status');
  const welcomeColorInput = document.getElementById('welcomeColor');
  const hexColorPattern = /^[0-9A-Fa-f]{6}$/;
  const previousErrorMessage = document.getElementById('colorErrorMessage');
  if (previousErrorMessage) {
      previousErrorMessage.remove();
  }

  if (!hexColorPattern.test(welcomeColor)) {
    const errorMessage = document.createElement('div');
    errorMessage.id = 'colorErrorMessage';
    errorMessage.className = 'error-message-color';
    welcomeColorInput.classList.add('input-error');
    return;
  } else {
    welcomeColorInput.classList.remove('input-error');
  }

  try {
    const response = await fetch('https://api.ouistitis.online/updateWelcomeSettings', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        token,
        welcomeMessage: {
          color: welcomeColor,
          title: welcomeTitle,
          description: welcomeDescription,
          displayAvatar
        }
      })
    });

    if (response.ok) {
      status.textContent = 'Configuration mise √† jour';
      status.classList.add('fade-out');
      status.classList.remove('fade-out-hidden');

      setTimeout(() => {
      }, 3000);
    } else {
      status.textContent = 'Erreur lors de la mise √† jour de la configuration';
      status.style.color = 'white';
    }
  } catch (error) {
    console.error('Erreur lors de la mise √† jour des param√®tres:', error);
    status.textContent = 'Erreur lors de la mise √† jour des param√®tres';
    status.style.color = 'white';
  }
});

    document.querySelectorAll('#welcomeTitle, #welcomeDescription, #welcomeColor, #displayAvatar').forEach(element => {
        element.addEventListener('input', updateWelcomePreview);
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('serverToken');
        localStorage.removeItem('isAuthenticated');
        abortController.abort();
        window.location.href = './';
    });

    document.getElementById('backBtn').addEventListener('click', () => {
        abortController.abort();
        window.location.href = './dashboard';
    });

    document.addEventListener('DOMContentLoaded', loadWelcomeConfig);
</script>

<style>
  .fade-out {
    opacity: 1;
    transition: opacity 0.5s ease-out;
  }
  .fade-out-hidden {
    opacity: 0;
  }
</style>

  <!-- 
    - #FOOTER
  -->

<footer class="footer">
  <div class="footer-bottom">
    <div class="container">
      <div class="footer-left">
        <a class="logo-footer">
          <img src="Ouistitis.png" width="50" height="50" alt="Logo">
        </a>
        <p class="copyright">
          &copy; 2024 Ouistitis. Tous droits r√©serv√©s.
        </p>
      </div>
      <ul class="footer-bottom-list">
        <li>
          <a href="https://discord.com/users/1238123562254995457" class="footer-bottom-link">Contacter le support</a>
        </li>
        <li>
          <a href="./privacy" class="footer-bottom-link">Politique de confidentialit√©</a>
        </li>
        <li>
          <a href="./terms" class="footer-bottom-link">Conditions d'utilisation</a>
        </li>
      </ul>
    </div>
  </div>
</footer>

  <!-- 
    - ionicon-link
  -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.8/dist/components/icon.min.css">

  <script src="assets/js/mobile-adapter.js" defer></script>
  <script src="assets/js/logout.js" defer></script>
  <script src="assets/js/script.js" defer></script>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

</body>

</html>